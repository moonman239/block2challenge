<html>
    <head>
        <title>The Foodie Traveler</title>
        <script>
            var restaurants = [];
            function ratingFunction(x,y)
            {
                return (x.rating > y.rating) ? -1 : 1;
            }
            function displayRestaurants(sortFunction = ratingFunction)
            {
                restaurants = restaurants.sort(sortFunction);
                const table = document.getElementById("restaurants");
                table.innerHTML = "";
                for (const i in restaurants)
                {
                    const name = restaurants[i].name;
                    if (name === undefined)
                    {
                        continue;
                    }
                    const nameHeader = "<h3>" + name + "</h3>";
                    const addressString = restaurants[i].address;
                    const description = restaurants[i].description;
                    const distance = restaurants[i].distance_string;
                    const rating = restaurants[i].rating;
                    const td1 = "<td>" + nameHeader + addressString + "</td>"
                    const td2 = "<td>" + distance + "</td>";
                    const td3 = "<td>" + rating + "</td>";
                    table.innerHTML += td1 + td2 + td3;
                }
            }
            function locationReceived(position)
            {

                console.log("location received.");
               let _fetch = fetch("https://travel-advisor.p.rapidapi.com/restaurants/list-by-latlng?latitude=" + position.coords.latitude + "&longitude=" + position.coords.longitude + "&currency=USD&open_now=false&lunit=mi&lang=en_US", {
                    "method": "GET",
                    "headers": {
                        "x-rapidapi-key": "1167886aeemsh061eed0f807e535p17f6aajsnc70cd0d6bdaa",
                        "x-rapidapi-host": "travel-advisor.p.rapidapi.com"
                    }
                })
                    .then(response => response.json());
                    _fetch.catch(alert);
                    _fetch.then(json => {
                        restaurants = json["data"];
                        displayRestaurants();
                    })
            }
            function getLocation() {
                navigator.geolocation.getCurrentPosition(locationReceived)
            }
        </script>
    </head>
    <body>
        <button onclick="getLocation()" title="">Get Location</button>
        <table id="restaurants">
            </table>
    </body>
</html>