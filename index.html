<html>
    <head>
        <title>The Foodie Traveler</title>
        <script>
            var restaurants = [];
            function ratingFunction(x,y)
            {
                return (x.rating > y.rating) ? -1 : 1;
            }
            function distanceFunction(x,y)
            {
                return (x.distance < y.distance) ? -1 : 1;
            }
            function displayRestaurants(sortFunction = ratingFunction)
            {
                restaurants = restaurants.sort(sortFunction);
                const table = document.getElementById("restaurants");
                table.innerHTML = "";
                for (const i in restaurants)
                {
                    const name = restaurants[i].name;
                    if (name === undefined)
                    {
                        continue;
                    }
                    const nameHeader = "<h3>" + name + "</h3>";
                    const addressString = restaurants[i].address;
                    const description = restaurants[i].description;
                    const distance = restaurants[i].distance_string;
                    const rating = restaurants[i].rating;
                    let openNow = restaurants[i].open_now_text;
                    if (openNow === undefined)
                    {
                        openNow = "";
                    }
                    const priceText = restaurants[i].price_level;
                    const td1 = "<td>" + nameHeader + addressString + "<br><br>" + openNow + "<br><br>" + description + "</td>"
                    const td2 = "<td>" + distance + "</td>";
                    const td3 = "<td>" + rating + "</td>";
                    const td4 = "<td>" + priceText + "</td>";
                    table.innerHTML += td1 + td2 + td3;
                }
            }
            function locationReceived(position)
            {

                console.log("location received.");
               let _fetch = fetch("https://travel-advisor.p.rapidapi.com/restaurants/list-by-latlng?latitude=" + position.coords.latitude + "&longitude=" + position.coords.longitude + "&currency=USD&open_now=false&lunit=mi&lang=en_US", {
                    "method": "GET",
                    "headers": {
                        "x-rapidapi-key": "1167886aeemsh061eed0f807e535p17f6aajsnc70cd0d6bdaa",
                        "x-rapidapi-host": "travel-advisor.p.rapidapi.com"
                    }
                })
                    .then(response => response.json());
                    _fetch.catch(alert);
                    _fetch.then(json => {
                        restaurants = json["data"];
                        console.log(restaurants);
                        displayRestaurants();
                    })
            }
            function getLocation() {
                navigator.geolocation.getCurrentPosition(locationReceived)
            }
            function changeSort(select)
            {
                if (select.value === "rating")
                    displayRestaurants(ratingFunction);
                else
                    displayRestaurants(distanceFunction);
            }
        </script>
        <style>
            #header {
                position: fixed;
                top: 0px;
            }
        </style>
    </head>
    <body>
        <div id="header">
        <input type="text" id="query" placeholder="Search by cuisine, etc."><button onclick="getLocation()" title="">Get Location</button>
        
        <select onchange="changeSort(this)">
            <option value="rating">Rating</option>
            <option value="distance">Distance</option>
        </select>
        </div>
        <table id="restaurants">
            </table>
    </body>
</html>